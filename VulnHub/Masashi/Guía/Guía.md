# Antecedentes
El presente documento recoge los resultados obtenidos durante la fase de auditoría a la máquina Mercury de la plataforma VulnHub.

**Figura 1:** Detalles de la máquina

Dirección URL: [https://www.vulnhub.com/mercury](https://www.vulnhub.com/entry/the-planets-mercury,544/)

## Objetivos
Conocer el estado de seguridad actual del servidor Mercury, enumerando posibles vectores de explotación y determinando el alcance e impacto que un atacante podría ocasionar sobre el sistema en producción.

### 2.1. Consideraciones
Una vez finalizadas las jornadas de auditoría, se llevará a cabo una fase de saneamientos y buenas prácticas con el objetivo de securizar el servidor y evitar ser víctimas de un futuro ataque en base a los vectores explotados.

**Figura 2:** Flujo de trabajo
1. Reconocimiento sobre el sistema
2. Detección de vulnerabilidades
3. Explotación de vulnerabilidades
4. Securización del sistema

# 3. Análisis de Vulnerabilidad
## 3.1. Reconocimiento inicial
Se comenzó realizando un análisis inicial sobre el sistema, verificando que el sistema objetivo se encuentre accesible desde el segmento de red en el que se opera. A partir de ahora trabajamos como root.

Comenzamos descubriendo nuestra IP en la red:

```bash
ip a
```

Y escaneamos la misma red mediante el comando:

```bash
arp-scan --interface=enp03 --localnet
```


Una vez localizado, se realizó un escaneo a través de la herramienta nmap para la detección de puertos abiertos, obteniendo los siguientes resultados:

```bash
nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.40.2.12 -oG Allports
```

Por pantalla se muestra abierto el puerto 22 SSH y 8080 HTTP, los cuales se escanearán más a fondo individualmente.

Asimismo, con el objetivo de evitar falsos positivos, se diseñó un script en Bash para enumerar posibles puertos adicionales que la herramienta nmap no llegaría a detectar:

```bash
bash
Copy code
#!/bin/bash

for port in $(seq 1 65535); do
  timeout 1 bash -c "echo > /dev/tcp/10.10.10.52/$port" > /dev/null 2>&1 && echo "$port/tcp"
done; wait
```
## 3.2 Intrusión: Explotación de SQL Injection
Al ejecutar el enlace proporcionado, descubrí la página Fact id:1, lo que me llevó a la conclusión de que debe haber alguna base de datos desde la cual se ha llamado Fact id 1. Probablemente, esta página pueda ser vulnerable a la inyección SQL. Vamos a verificar esto.

Figura 7: Página Fact id:1

# 4. Explotación de Vulnerabilidades
Para explorar posibles vulnerabilidades de inyección SQL, utilizamos sqlmap con algunos comandos básicos. Primero, enumeramos las bases de datos:

bash
Copy code
sqlmap http://<<IP>>:8080/mercuryfacts/ -u --dbs --batch
Figura 8: Resultados de la enumeración de bases de datos

Después de extraer la información, encontramos dos bases de datos, y la base de datos "mercury" parece contener información relevante.

Figura 9: Base de datos "mercury"

Dado que confirmamos la vulnerabilidad de la página contra SQLi, decidimos extraer todos los contenidos disponibles en la base de datos "mercury" con el siguiente comando:

bash
Copy code
sqlmap -u http://<<IP>>:8080/mercuryfacts -D mercury --dumpall --batch
Figura 10: Extracción de información de la base de datos "mercury"

Encontramos cuatro entradas en la tabla llamada 'USER'. El parámetro '--dumpall' en el comando lista todas las bases de datos, el contenido de todas las tablas junto con los nombres de usuario y contraseñas. La cuarta entrada parece interesante.





